from utime import *
import framebuf

# Requires my modified version
# https://github.com/mungewell/pico-oled-1.3-driver/tree/pico_timecode

from libs.PicoOled13 import *

# digits 0..9 16x16 bitmaps
combined = [
bytearray([ # :0
0x00,0x04,0x80,0x3f,0xc0,0x7f,0xe0,0x71,0xe7,0xe0,0xe7,0xe0,0xe7,0xe0,0xe0,0xe0,
0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xf0,0xc7,0x79,0xc7,0x7f,0x87,0x3f,0x00,0x00]),
bytearray([ # :1
0x00,0x00,0x00,0x0f,0x80,0x0f,0xc0,0x0f,0xc7,0x0e,0x07,0x0e,0x07,0x0e,0x00,0x0e,
0x00,0x0e,0x00,0x0e,0x00,0x0e,0x00,0x0e,0x07,0x0e,0xc7,0xff,0xc7,0xff,0x00,0x00]),
bytearray([ # :2
0x00,0x04,0x80,0x3f,0xc0,0x7f,0xe0,0x71,0xe7,0xe0,0x07,0x70,0x07,0x78,0x00,0x7c,
0x00,0x3e,0x00,0x0f,0x80,0x07,0xc0,0x03,0xe7,0x01,0xe7,0xff,0xe7,0xff,0x00,0x00]),
bytearray([ # :3
0x00,0x06,0xc0,0x3f,0xc0,0x7f,0xe0,0x71,0xe7,0x70,0x07,0x70,0x07,0x7f,0x00,0x3f,
0x00,0x7f,0x00,0xf0,0xc0,0xe0,0xe0,0xe0,0xe7,0xf9,0xc7,0x7f,0x87,0x3f,0x00,0x00]),
bytearray([ # :4
0x00,0x00,0x00,0x38,0x00,0x3c,0x00,0x3e,0x07,0x3f,0x07,0x3f,0x87,0x3b,0xc0,0x39,
0xe0,0x39,0xe0,0x38,0xf0,0xff,0xf0,0xff,0x07,0x38,0x07,0x38,0x07,0x38,0x00,0x00]),
bytearray([ # :5
0x00,0x00,0xc0,0x7f,0xc0,0x7f,0xc0,0x00,0xe7,0x00,0xe7,0x0c,0xe7,0x3f,0xe0,0x7f,
0xe0,0xf0,0x00,0xe0,0x00,0xe0,0xe0,0xf0,0xe7,0xf9,0xc7,0x7f,0x87,0x3f,0x00,0x00]),
bytearray([ # :6
0x00,0x1e,0x80,0x3f,0xc0,0x7f,0xc0,0x71,0xe7,0x01,0xe7,0x1e,0xe7,0x7f,0xe0,0x7f,
0xe0,0xf1,0xe0,0xe0,0xe0,0xe0,0xe0,0xe1,0xc7,0x7b,0xc7,0x7f,0x07,0x3f,0x00,0x00]),
bytearray([ # :7
0x00,0x00,0xe0,0xff,0xe0,0xff,0x00,0x70,0x07,0x78,0x07,0x38,0x07,0x1c,0x00,0x1c,
0x00,0x0e,0x00,0x0e,0x00,0x07,0x00,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x00,0x00]),
bytearray([ # :8
0x00,0x0f,0xc0,0x7f,0xc0,0x7f,0xe0,0x71,0xe7,0xe0,0xe7,0x71,0xc7,0x7f,0xc0,0x3f,
0xe0,0x7f,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe7,0xf1,0xc7,0x7f,0x87,0x3f,0x00,0x00]),
bytearray([ # :9
0x00,0x0f,0xc0,0x3f,0xc0,0x7f,0xe0,0x71,0xe7,0xf0,0xe7,0xe0,0xe0,0xf0,0xe0,0xf9,
0xc0,0xff,0x80,0xff,0x00,0xf0,0xe0,0x70,0xe7,0x79,0xc7,0x3f,0x87,0x1f,0x00,0x00]),
]

fb = []
for i in range(len(combined)):
    fb.append(framebuf.FrameBuffer(combined[i], 16, 16, framebuf.MONO_HMSB))

display=OLED_1inch3_SPI()

display.fill(0x0000)
display.text("Blit Test:",0,0,0xffff)
display.show()

c = 0
last = "--------"
start = ticks_ms()
while c < 1000:
    data = '{:08d}'.format(c)
    c=c+1
    
    # find 1st character that has changed
    # only update screen from there
    for j in range(len(data)):
        if data[j]!=last[j]:
            break
    last = data

    for i in range(7, (j & 6)-1, -1):
        # blit with combined char set
        # draw right most character first
        # slightly offset 1's vs 10's to hide colon
        display.blit(fb[int(data[i])],
            (16*i)-(4 if i&1 else 0), 48)
            
    # blank first ':' (left most of screen)
    if j < 2:
        display.rect(0,48,4,16,display.black,True)
        
    #display.show()                 # 4.5fps
    #display.show(48)               # 18fps
    display.show(48, 64, j*16)      # 80fps

display.text("time: "+str(ticks_diff(ticks_ms(), start))+"ms",0,16,0xffff)
display.show()
